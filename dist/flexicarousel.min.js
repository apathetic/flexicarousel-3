/*! Flexicarousel 2 - v0.3.0 - 2014-03-29
* https://github.com/apathetic/flexicarousel-2
* Copyright (c) 2014 Wes Hatch; Licensed MIT */
var Carousel=function(a,b){this.el=a,this.current=0,this.slides=[],this.sliding=!1,this.width=0,this.defaults={activeClass:"active",beforeClass:"before",afterClass:"after",slideWrap:".wrap",slides:"li",infinite:!0},this.delta=0,this.dragging=0,this.startClientX=0,this.pixelOffset=0,this.touchPixelRatio=1,this.dragThreshold=100,this.transitionEnd=function(){var a,b=document.createElement("fake"),c={transition:"transitionend",OTransition:"oTransitionEnd otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(b.style[a]!==undefined)return c[a];return!1}(),this.init(b)};Carousel.prototype={init:function(a){this.options=this._extend(this.defaults,a),this.slideWrap=this.el.querySelector(this.options.slideWrap),this.slides=this.slideWrap.children;if(!this.slideWrap||!this.slides.length)return;return this.slides.length<3&&(this.options.infinite=!1),this._setIndices(0),this._addClass(this.before,this.options.beforeClass),this._addClass(this.current,this.options.activeClass),this._addClass(this.after,this.options.afterClass),this.options.noTouch===undefined&&(this.slideWrap.addEventListener("touchstart",this._dragStart.bind(this)),this.slideWrap.addEventListener("touchmove",this._drag.bind(this)),this.slideWrap.addEventListener("touchend",this._dragEnd.bind(this))),this.width=this.slideWrap.offsetWidth,this},next:function(){this.after!==null&&!this.sliding&&(this.slides[this.current].classList.add(this.options.beforeClass),this._move(this.current+1))},prev:function(){this.before!==null&&!this.sliding&&(this.slides[this.current].classList.add(this.options.afterClass),this._move(this.current-1))},go:function(a){var b;a=Math.max(Math.min(this.slides.length-1,a),0);if(a==this.current||this.sliding)return;b=Math.abs(this.current-a)/(this.current-a),b>0?(this._addClass(a,this.options.beforeClass),this._removeClass(a,this.options.afterClass),this._addClass(this.current,this.options.afterClass)):(this._addClass(a,this.options.afterClass),this._addClass(this.current,this.options.beforeClass)),this.slides[a].offsetHeight,this._move(a)},_move:function(a){var b;a=this._loop(a),this.options.beforeSlide&&this.options.beforeSlide(a,this.current),this._addClass(a,"animate"),this._addClass(this.current,"animate"),this._removeClass(this.current,this.options.activeClass),this._addClass(a,this.options.activeClass),this._removeClass(a,this.options.beforeClass),this._removeClass(a,this.options.afterClass),this.transitionEnd?(b=this,this.slides[a].addEventListener(b.transitionEnd,function c(){this.removeEventListener(b.transitionEnd,c),b._moveEnd(a)}),this.sliding=!0):this._moveEnd(a)},_moveEnd:function(a){this._removeClass(a,"animate"),this._removeClass(this.current,"animate"),this._setIndices(a),this._addClass(this.before,this.options.beforeClass),this._addClass(this.after,this.options.afterClass),this._removeClass(this.before,this.options.afterClass),this._removeClass(this.after,this.options.beforeClass),this.options.afterSlide&&this.options.afterSlide(this.current),this.sliding=!1},_dragStart:function(a){if(this.sliding)return!1;a.touches&&(a=a.touches[0]),this.dragging===0&&(this.dragging=1,this.pixelOffset=0,this.startClientX=a.clientX,this.touchPixelRatio=1)},_drag:function(a){a.preventDefault(),a.touches&&(a=a.touches[0]),this.touchPixelRatio=1,this.delta=a.clientX-this.startClientX,this.dragging&&this.delta!==0&&(this.pixelOffset=this.delta/this.touchPixelRatio,this._translate(this.before,this.pixelOffset-this.width),this._translate(this.current,this.pixelOffset),this._translate(this.after,this.pixelOffset+this.width))},_dragEnd:function(a){var b;if(this.dragging===0)return!1;this.dragging=0,this.pixelOffset<0?Math.abs(this.pixelOffset)<this.dragThreshold||this.after===null?this._move(this.current):this.next():this.pixelOffset>0&&(this.pixelOffset<this.dragThreshold||this.before===null?this._move(this.current):this.prev());for(b=this.slides.length;b--;)this.slides[b].style.webkitTransform=""},_setIndices:function(a){this.current=a,this.before=!this.options.infinite&&this.current===0?null:this._loop(a-1),this.after=!this.options.infinite&&this.current==this.slides.length-1?null:this._loop(a+1)},_loop:function(a){return(this.slides.length+a%this.slides.length)%this.slides.length},_addClass:function(a,b){var c;if(a===null)return;c=this.slides[a],c.classList?c.classList.add(b):c.className+=" "+b},_removeClass:function(a,b){var c;if(a===null)return;c=this.slides[a],c.classList?c.classList.remove(b):c.className=c.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},_translate:function(a,b){if(a===null)return;this.slides[a].style.webkitTransform="translate("+b+"px, 0)"},_extend:function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a}},(window.jQuery||window.Zepto)&&function(a){a.fn.carousel=function(b){var c=arguments;return this.each(function(){if(a(this).data("carousel"))return b in Carousel.prototype?Carousel.prototype[b].apply(a(this).data("carousel"),Array.prototype.slice.call(c,1)):(a.error('Method "'+b+'" does not exist on ye olde carousel'),a(this));if(typeof b=="object"||!b){var d=new Carousel(a(this)[0],c[0]);return a(this).data("carousel",d)}})}}(window.jQuery||window.Zepto);